<% content_for :title, "Treatment Plan Details" %>

<div class="max-w-4xl mx-auto bg-white p-6 mt-6 rounded-lg shadow-md space-y-6">
  <% if notice %>
    <p class="text-green-600 font-medium"><%= notice %></p>
  <% end %>

  <div class="space-y-2">
    <h2 class="text-2xl font-bold text-blue-700"><%= @treatment_plan.title %></h2>
    <p class="text-gray-700 whitespace-pre-line"><%= @treatment_plan.notes %></p>
  </div>

  <div>
    <h3 class="text-xl font-semibold text-gray-800 mb-2">Exercises in Plan</h3>

    <% if @treatment_plan.treatment_plan_exercises.any? %>
      <ul class="divide-y divide-gray-200">
        <% @treatment_plan.treatment_plan_exercises.each do |exercise| %>
          <li class="py-6">
            <div class="flex justify-between items-start gap-8">
              <!-- Text Section -->
              <div class="flex-1 max-w-2xl">
                <h4 class="text-xl font-semibold text-gray-900">
                  <%= exercise.custom_title.presence || exercise.exercise.title %>
                </h4>
                <p class="text-sm text-gray-700 mt-2 whitespace-pre-line"><%= exercise.instructions %></p>
                <p class="text-sm text-gray-700 mt-2">
                  <strong>Sets:</strong> <%= exercise.sets %> &nbsp;
                  <strong>Reps:</strong> <%= exercise.reps %>
                </p>
              </div>

              <!-- Media Section -->
              <% if exercise.exercise.media.attached? %>
                <div class="w-64 h-48 flex-shrink-0 border border-gray-200 rounded-lg overflow-hidden bg-white">
                  <% if exercise.exercise.media.video? %>
                    <video controls class="w-full h-full object-contain">
                      <source src="<%= url_for(exercise.exercise.media) %>" type="<%= exercise.exercise.media.content_type %>">
                      Your browser does not support the video tag.
                    </video>
                  <% else %>
                    <%= image_tag exercise.exercise.media, class: "w-full h-full object-contain" %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-gray-500">No exercises have been added to this plan yet.</p>
    <% end %>
  </div>
  <div class="flex flex-wrap items-center gap-4 pt-4 border-t border-gray-200">
    <%= link_to "Edit Treatment Plan", edit_patient_treatment_plan_path(@treatment_plan.patient, @treatment_plan), class: "underline text-blue-600 text-sm font-medium hover:text-blue-800" %>
    <%= link_to "Back to Patient", patient_path(@treatment_plan.patient), class: "underline text-blue-600 text-sm font-medium hover:text-blue-800" %>
    <%= button_to "Delete Plan", patient_treatment_plan_path(@treatment_plan.patient, @treatment_plan), method: :delete, data: { confirm: "Are you sure?" }, class: "text-sm text-red-600 hover:text-red-800 bg-white border border-red-600 px-3 py-1 rounded-md transition" %>
  </div>
</div>

